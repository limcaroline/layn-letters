{% extends "base.html" %}
{% block title %}{{ view.object|default:"New" }} Itinerary{% endblock %}
{% block content %}
<h1 class="h4">{{ view.object|default:"New" }} Itinerary</h1>
<form method="post">{% csrf_token %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  {{ form.as_p }}
  {{ formset.management_form }}

  {% if formset.non_form_errors %}
    <div class="alert alert-danger">
      {{ formset.non_form_errors }}
    </div>
  {% endif %}

  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr><th>Day</th><th>Title</th><th>Location</th>
            <th>Notes</th><th>Delete</th></tr>
      </thead>
      <tbody>
        {% for f in formset %}
        <tr>
          {% for hidden in f.hidden_fields %}
            {{ hidden }}
          {% endfor %}

          {# Show field errors per row #}
          {% if f.errors %}
            <td colspan="5">
              <div class="alert alert-danger mb-2">
                {{ f.errors }}
              </div>
            </td>
          {% endif %}
          
          <td>{{ f.day }}</td><td>{{ f.title }}</td><td>{{ f.location }}</td>
          <td>{{ f.notes }}</td>
          <td>{% if f.instance.pk %}{{ f.DELETE }}{% endif %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <button class="btn btn-primary">Save</button>
</form>
{% endblock %}
